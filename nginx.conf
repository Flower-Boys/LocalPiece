# 워커 프로세스 수 (보통 CPU 코어 수에 맞춤)
worker_processes 1;

events {
  # 워커 프로세스당 동시 접속 수
  worker_connections 1024;
}

http {
  # 응답 헤더에 Nginx 버전 정보 숨기기
  server_tokens off;

  # 기본 MIME 타입 설정
  include /etc/nginx/mime.types;
  default_type application/octet-stream;

  # 로그 형식
  log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                  '$status $body_bytes_sent "$http_referer" '
                  '"$http_user_agent" "$http_x_forwarded_for"';

  # 서버 블록
  server {
    # 80번 포트 리스닝
    listen 80;

    # 모든 요청 처리
    location /api/ {
      # 요청을 app이라는 이름의 서비스(docker-compose에서 정의)의 8080포트로 전달
      proxy_pass http://app:8080; 
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
    }
  }
}