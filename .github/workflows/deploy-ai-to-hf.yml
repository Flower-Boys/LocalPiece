name: Deploy AI to Hugging Face Hub

# ì–¸ì œ ì´ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í• ì§€ ì •ì˜í•©ë‹ˆë‹¤.
on:
  push:
    branches:
      - AI # main ë¸Œëœì¹˜ì— push ë  ë•Œ
    paths:
      - 'AI/**' # ê·¸ë¦¬ê³  ë³€ê²½ëœ íŒŒì¼ì´ 'AI/' í´ë” ì•ˆì— ìˆì„ ë•Œë§Œ ì‹¤í–‰

jobs:
  deploy-to-hf-space:
    runs-on: ubuntu-latest
    steps:
      # 1. ìš°ë¦¬ GitHub ì €ì¥ì†Œì˜ ì½”ë“œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Hugging Face Space ì €ì¥ì†Œë¥¼ 'hf-space'ë¼ëŠ” ì´ë¦„ì˜ í´ë”ì— í´ë¡ í•©ë‹ˆë‹¤.
      #    (ì¸ì¦ ì •ë³´ë¥¼ URLì— í¬í•¨í•˜ì—¬ Private ì €ì¥ì†Œ í´ë¡ )
      - name: Clone Hugging Face space
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: git clone https://Min9yu:${HF_TOKEN}@huggingface.co/spaces/Min9yu/localpiece-ai-generator hf-space

      # 3. ìš°ë¦¬ ì €ì¥ì†Œì˜ AI/ í´ë” ë‚´ìš©ì„ hf-space í´ë”ë¡œ ì™„ë²½í•˜ê²Œ ë³µì‚¬(ë™ê¸°í™”)í•©ë‹ˆë‹¤.
      - name: Sync AI directory to HF space
        run: rsync -av --delete --exclude='.git/' AI/ hf-space/

      # 4. hf-space í´ë”ë¡œ ì´ë™í•˜ì—¬ ë³€ê²½ì‚¬í•­ì„ Hugging Face ì €ì¥ì†Œì— pushí•©ë‹ˆë‹¤.
      - name: Push to Hugging Face Hub
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          cd hf-space
          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          git add .
          # ë³€ê²½ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹í•˜ê³  í‘¸ì‹œí•©ë‹ˆë‹¤.
          if ! git diff --staged --quiet; then
            git commit -m "ğŸš€ Auto-deploy from main repo"
            # push í•  ë•Œë„ ì¸ì¦ ì •ë³´ë¥¼ URLì— í¬í•¨í•˜ëŠ” ê²ƒì´ ê°€ì¥ í™•ì‹¤í•©ë‹ˆë‹¤.
            git push https://Min9yu:${HF_TOKEN}@huggingface.co/spaces/Min9yu/localpiece-ai-generator main
          else
            echo "No changes to deploy."
          fi
