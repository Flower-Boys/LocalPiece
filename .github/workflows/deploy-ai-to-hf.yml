name: Deploy AI to Hugging Face Hub

on:
  push:
    branches:
      - AI
    paths:
      - 'AI/**'

jobs:
  deploy-to-hf-space:
    runs-on: ubuntu-latest
    steps:
      # 1. ìš°ë¦¬ GitHub ì €ì¥ì†Œì˜ ì½”ë“œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Hugging Faceì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ Git ì¸ì¦ ì •ë³´ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. (ë” ì•ˆì •ì ì¸ ë°©ë²•)
      # "ì•ìœ¼ë¡œ https://huggingface.co ì£¼ì†Œë¥¼ ë§Œë‚˜ë©´, ì•„ë˜ ì¸ì¦ ì •ë³´ê°€ í¬í•¨ëœ ì£¼ì†Œë¡œ ëŒ€ì‹  ì‚¬ìš©í•´ë¼" ë¼ê³  Gitì—ê²Œ ì•Œë ¤ì¤ë‹ˆë‹¤.
      - name: Configure Git for Hugging Face
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: git config --global url."https://Min9yu:${HF_TOKEN}@huggingface.co".insteadOf "https://huggingface.co"

      # 3. ì´ì œ ì¸ì¦ ì •ë³´ ì—†ì´ ì›ë˜ ì£¼ì†Œë¡œ í´ë¡ í•©ë‹ˆë‹¤. Gitì´ ìœ„ì—ì„œ ì„¤ì •í•œ ê·œì¹™ì— ë”°ë¼ ìë™ìœ¼ë¡œ ì¸ì¦í•©ë‹ˆë‹¤.
      - name: Clone Hugging Face space
        run: git clone https://huggingface.co/spaces/Min9yu/localpiece-ai-generator hf-space

      # 4. ìš°ë¦¬ ì €ì¥ì†Œì˜ AI/ í´ë” ë‚´ìš©ì„ hf-space í´ë”ë¡œ ë™ê¸°í™”í•©ë‹ˆë‹¤.
      - name: Sync AI directory to HF space
        run: rsync -av --delete --exclude='.git/' AI/ hf-space/

      # 5. hf-space í´ë”ë¡œ ì´ë™í•˜ì—¬ ë³€ê²½ì‚¬í•­ì„ Hugging Face ì €ì¥ì†Œì— pushí•©ë‹ˆë‹¤.
      - name: Push to Hugging Face Hub
        run: |
          cd hf-space
          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          git add .
          if ! git diff --staged --quiet; then
            git commit -m "ğŸš€ Auto-deploy from main repo"
            # push í•  ë•Œë„ Gitì´ ìë™ìœ¼ë¡œ ì¸ì¦ ì •ë³´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
            git push origin main
          else
            echo "No changes to deploy."
          fi

